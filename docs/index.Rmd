---
title: "lglasso: identify networks from correlated data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction_of_lglasso_package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This package implements the algorithms proposed in Zhou et al. (2021), which aims to estimates the microbial interaction network based on Gaussian graphical model and irregularly-spaced longitudinal data. There are two related models in Zhou et al. (2021)  which can handle two different questions.  The first model is called homogeneous stationary Gaussian graphical model (SGGM) in which all the subjects share a same auto-correlation parameter $\tau$. For homogeneous SGGM, an iterative graphical lasso algorithm is proposed to compute the $l_1$ penalized  maximum  likelihood estimate (MLE) of the network. The second model is called heterogeneous SGGM in which each subject possesses his/her own auto-correlation parameter $\tau_i$. For heterogeneous SGGM, given the complex form of its likelihood function, an expectation-maximization (EM) type algorithm is devised to compute the $l_1$ penalized MLE of the network and $\tau_i$'s, which integrates the  EM algorithm with conventional graphical lasso algorithm (Friedman (2019)) and therefore can be implemented  very efficiently. For the details of the algorithms and the output of the packages, please see Zhou et al. (2021). 




```{r setup, message=FALSE}
library(lglasso)
```

There are two main functions in this package. The first one is $lglasso$ which can output a sparse network representing the precision matrix by maximizing the $l_1$ penalized likelihood function. The second function if $mle$, which can compute the maximum likelihood estimates of precision matrix and the correlation parameter $\tau$ for a given network structure produced from function $lglasso$.   

```{r, message=FALSE}
p=10
m1=10
m2=0
m3=5
n=20
rho=0.8

```

## Model 1: clustered data with no correlation structure
```{r, message=FALSE}
set.seed(5)
cc=matrix(rho,ncol = m3,nrow = m3)
diag(cc)=1
dd=simulate(n=n,p=p,m1=m1,m2=m2,m3=m3,cc=cc,homo=T)
ddata=dd$data
```

### estimate individual networks
```{r}
aa=lglasso(data=ddata,lambda = c(0.1,0.1),type="general",group = ddata[,2])
aa
cov2cor(aa$v)
```

### estiamte general networks

```{r}
aa=lglasso(data=ddata,lambda = 0.1,type="general")
aa
cov2cor(aa$v)
```

## Model 2: longitudinal data with one-parameter structured correlation 


```{r}

 set.seed(5)
dd=simulate_long(n=n,p=p,m1=m1,tau=c(2,1))
ddata=dd$data
group=rep(c(1,2),71)
```


### estimate individual networks

```{r}
aa=lglasso(data=ddata,lambda = c(0.1,0.1),type="expFixed",expFix=1,group = group)
aa
```


### estiamte general networks

```{r}
aa=lglasso(data=ddata,lambda = 0.1,,type="expFixed",expFix=1)
aa
```


## Model 3: longitudinal data with two-parameter structured correlation 

```{r}

set.seed(5)
dd=simulate_long(n=n,p=p,m1=m1,tau=c(2,1))
ddata=dd$data
group=rep(c(1,2),71)
```


### estimate individual networks

```{r}
aa=lglasso(data=ddata,lambda = c(0.001,0.1),type="twoPara",group=group)
aa
```


### estiamte general networks

```{r}
aa=lglasso(data=ddata,lambda = 0.001,type="twoPara")
aa
```




[1] Zhou, J., Gui, J., Viles, W.D., Chen, H., Madan, J.C., Coker, M.O., Hoen, A.G., 2021a. Identifying Microbial Interaction Networks Based on Irregularly Spaced Longitudinal 16S rRNA sequence data. https://doi.org/10.1101/2021.11.26.470159



[2] Friedman J., Hastie T., Tibshirani R. (2019)  Graphical Lasso: Estimation of Gaussian Graphical Models, Version: 1.11. https://CRAN.R-project.org/package=glasso. 

